!function(){"use strict";var e={n:function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,{a:n}),n},d:function(t,n){for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.jQuery,n=e.n(t);const a=e=>awxExpressCheckoutSettings.ajaxUrl.toString().replace("%%endpoint%%","airwallex_"+e),s=e=>{var t,s,i,o;const r={security:awxExpressCheckoutSettings.nonce.shipping,country:null!==(t=e.countryCode)&&void 0!==t?t:"",state:null!==(s=e.administrativeArea)&&void 0!==s?s:"",postcode:null!==(i=e.postalCode)&&void 0!==i?i:"",city:null!==(o=e.locality)&&void 0!==o?o:""};return n().ajax({type:"POST",data:r,url:a("get_shipping_options")}).done((function(e){return e})).fail((function(e){return{success:!1,message:e}}))},i=(e,t)=>{for(let n in t)t[n]=e;const s={security:awxExpressCheckoutSettings.nonce.updateShipping,shippingMethods:t};return n().ajax({type:"POST",data:s,url:a("update_shipping_method")}).done((function(e){return e})).fail((function(e){return{success:!1,message:e}}))},o=()=>{let e=n()(".single_add_to_cart_button").val();n()(".single_variation_wrap").length&&(e=n()(".single_variation_wrap").find('input[name="product_id"]').val());let t={security:awxExpressCheckoutSettings.nonce.estimateCart,product_id:e,qty:n()(".quantity .qty").val(),attributes:n()(".variations_form").length?p().data:[]},s=n()("form.cart").serializeArray();return n().each(s,(function(e,n){if(/^addon-/.test(n.name))if(/\[\]$/.test(n.name)){let e=n.name.substring(0,n.name.length-2);t[e]?t[e].push(n.value):t[e]=[n.value]}else t[n.name]=n.value})),n().ajax({type:"POST",data:t,url:a("get_estimated_cart_details")}).done((function(e){return e})).fail((function(e){return{success:!1,message:e}}))},r=()=>{let e=n()(".single_add_to_cart_button").val();n()(".single_variation_wrap").length&&(e=n()(".single_variation_wrap").find('input[name="product_id"]').val());let t={security:awxExpressCheckoutSettings.nonce.addToCart,product_id:e,qty:n()(".quantity .qty").val(),attributes:n()(".variations_form").length?p().data:[]},s=n()("form.cart").serializeArray();return n().each(s,(function(e,n){if(/^addon-/.test(n.name))if(/\[\]$/.test(n.name)){let e=n.name.substring(0,n.name.length-2);t[e]?t[e].push(n.value):t[e]=[n.value]}else t[n.name]=n.value})),n().ajax({type:"POST",data:t,url:a("add_to_cart")}).done((function(e){return e})).fail((function(e){return{success:!1,message:e}}))},c=()=>{const e={security:awxExpressCheckoutSettings.nonce.payment};return n().ajax({type:"POST",data:e,url:a("get_cart_details")}).done((function(e){return e})).fail((function(e){return{success:!1,message:e}}))},l=(e,t)=>{const s="googlepay"===t?u(e):d(e);return n().ajax({type:"POST",data:s,url:a("create_order")}).done((function(e){return e})).fail((function(e){return e}))},p=()=>{let e=n()(".variations_form").find(".variations select"),t={},a=0,s=0;return e.each((function(){let e=n()(this).data("attribute_name")||n()(this).attr("name"),i=n()(this).val()||"";i.length>0&&s++,a++,t[e]=i})),{count:a,chosenCount:s,data:t}},u=e=>{const t=e.paymentMethodData.info.billingAddress,n=e.shippingAddress,a={billing_first_name:t?t.name.split(" ").slice(0,1).join(" "):"",billing_last_name:t?t.name.split(" ").slice(1).join(" "):"",billing_company:"",billing_email:e.email?e.email:"",billing_phone:t?t.phoneNumber:"",billing_country:t?t.countryCode:"",billing_address_1:t?t.address1:"",billing_address_2:t?t.address2.concat(" ",t.address3).trim():"",billing_city:t?t.locality:"",billing_state:t?t.administrativeArea:"",billing_postcode:t?t.postalCode:""},s={shipping_first_name:n?n.name.split(" ").slice(0,1).join(" "):"",shipping_last_name:n?n.name.split(" ").slice(1).join(" "):"",shipping_company:n&&n.organization?n.organization:"",shipping_country:n?n.countryCode:"",shipping_address_1:n?n.address1:"",shipping_address_2:n?n.address2.concat(" ",n.address3).trim():"",shipping_city:n?n.locality:"",shipping_state:n?n.administrativeArea:"",shipping_postcode:n?n.postalCode:"",shipping_method:[e.shippingOptionData?e.shippingOptionData.id:null]};return Object.assign({_wpnonce:awxExpressCheckoutSettings.nonce.checkout,order_comments:"",payment_method:"airwallex_express_checkout",ship_to_different_address:1,terms:1,payment_method_type:"googlepay"},a,s)},d=e=>{let t=e.billingContact;const n=e.shippingContact,a={billing_first_name:t?t.givenName:"",billing_last_name:t?t.familyName:"",billing_company:"",billing_email:t&&t.emailAddress?t.emailAddress:n?n.emailAddress:"",billing_phone:t&&t.phoneNumber?t.phoneNumber:n?n.phoneNumber:"",billing_country:t?t.countryCode:"",billing_address_1:t&&t.addressLines&&t.addressLines.length>0?t.addressLines.shift():"",billing_address_2:t&&t.addressLines?t.addressLines.join(" "):"",billing_city:t?t.locality?t.locality:t.administrativeArea:"",billing_state:t?t.administrativeArea:"",billing_postcode:t?t.postalCode:""},s={shipping_first_name:n?n.givenName:"",shipping_last_name:n?n.familyName:"",shipping_company:"",shipping_country:n?n.countryCode:"",shipping_address_1:n&&n.addressLines&&n.addressLines.length>0?n.addressLines.shift():"",shipping_address_2:n&&n.addressLines?n.addressLines.join(" "):"",shipping_city:n?n.locality?n.locality:n.administrativeArea:"",shipping_state:n?n.administrativeArea:"",shipping_postcode:n?n.postalCode:"",shipping_method:e.shippingMethods?e.shippingMethods:[null]};return Object.assign({_wpnonce:awxExpressCheckoutSettings.nonce.checkout,order_comments:"",payment_method:"airwallex_express_checkout",ship_to_different_address:1,terms:1,payment_method_type:"applepay"},a,s)},g=function(){jQuery.unblockUI()},h=["email","name","phone","postalAddress"],m=e=>e?["email","name","phone","postalAddress"]:["email","phone"],y=e=>e.map((e=>({label:e.label,amount:e.price})));jQuery((function(e){let t=[],p=[],u={};const d={init:async function(){if(!("awxExpressCheckoutSettings"in window)||0===Object.keys(awxExpressCheckoutSettings).length)return;if(u=awxExpressCheckoutSettings.isProductPage?await o():await c(),!u?.orderInfo?.total?.amount)return;const{button:e,checkout:t}=awxExpressCheckoutSettings,n="recurring"===e.mode?"recurring":"oneoff";awxExpressCheckoutSettings.applePayEnabled&&n in t.allowedCardNetworks.applepay&&t.allowedCardNetworks.applepay[n].length>0&&(Airwallex.destroyElement("applePayButton"),d.initApplePayButton()),awxExpressCheckoutSettings.googlePayEnabled&&n in t.allowedCardNetworks.googlepay&&t.allowedCardNetworks.googlepay[n].length>0&&(Airwallex.destroyElement("googlePayButton"),d.initGooglePayButton())},initGooglePayButton:async function(){const n=await d.getGooglePayRequestOptions(),a=Airwallex.createElement("googlePayButton",n);a.mount("awx-ec-google-pay-btn");a.on("ready",(t=>{e("#awx-express-checkout-wrapper").show(),e(".awx-google-pay-btn").show(),e("#awx-express-checkout-button-separator").show(),e(".awx-express-checkout-error").html("").hide()})),a.on("click",(t=>{e(".awx-express-checkout-error").html("").hide()})),a.on("shippingAddressChange",(async e=>{const{callbackTrigger:n,shippingAddress:i}=e.detail.intermediatePaymentData;"INITIALIZE"==n&&awxExpressCheckoutSettings.isProductPage&&await r();let o={};const c=await s(i);var l;c&&c.success?(t={shippingMethods:c.shipping.shippingMethods,shippingOptions:(l=c.shipping.shippingOptions,l.map((e=>({id:e.id,label:e.label,description:e.description}))))},o.shippingOptionParameters={defaultSelectedOptionId:t.shippingMethods[0],shippingOptions:t.shippingOptions},o=Object.assign(o,d.getGoogleTransactionInfo(c.cart))):(t=[],o.error={reason:"SHIPPING_ADDRESS_UNSERVICEABLE",message:c.message,intent:"SHIPPING_ADDRESS"}),a.update(o)})),a.on("shippingMethodChange",(async e=>{const{shippingOptionData:n}=e.detail.intermediatePaymentData;let s={};const o=await i(n.id,t.shippingMethods);o&&o.success?s=d.getGoogleTransactionInfo(o.cart):s.error={reason:"SHIPPING_OPTION_INVALID",message:o.message,intent:"SHIPPING_OPTION"},a.update(s)})),a.on("authorized",(async e=>{awxExpressCheckoutSettings.isProductPage&&await r();const t=await l(e.detail.paymentData,"googlepay");d.processPayment(a,t)})),a.on("error",(e=>{console.error("There was an error",e)}))},getGooglePayRequestOptions:async function(){const e=awxExpressCheckoutSettings.isProductPage?await o():await c(),{button:t,checkout:n,merchantInfo:a,transactionId:s}=awxExpressCheckoutSettings;if(!e.success)return console.warn(response.message),[];let i={mode:t.mode,buttonColor:t.theme,buttonType:t.buttonType,emailRequired:!0,billingAddressRequired:!0,billingAddressParameters:{format:"FULL",phoneNumberRequired:n.requiresPhone},merchantInfo:{merchantName:a.businessName},autoCapture:n.autoCapture},r=["PAYMENT_AUTHORIZATION"];e.requiresShipping&&(r.push("SHIPPING_ADDRESS","SHIPPING_OPTION"),i.shippingAddressRequired=!0,i.shippingOptionRequired=!0,i.shippingAddressParameters={phoneNumberRequired:n.requiresPhone}),i.callbackIntents=r;const l=d.getGoogleTransactionInfo(e);return i=Object.assign(i,l),i},getGoogleTransactionInfo:function(e){const{checkout:t,transactionId:n}=awxExpressCheckoutSettings;return{amount:{value:e.orderInfo.total.amount||0,currency:e.currencyCode||t.currencyCode},transactionId:n,totalPriceLabel:t.totalPriceLabel,countryCode:e.countryCode||t.countryCode,displayItems:e.orderInfo.displayItems}},initApplePayButton:()=>{const{checkout:t}=awxExpressCheckoutSettings,o=d.getApplePayRequestOptions(u),g=Airwallex.createElement("applePayButton",o);g.mount("awx-ec-apple-pay-btn"),g.on("ready",(t=>{(()=>{try{return"ApplePaySession"in window&&ApplePaySession?.supportsVersion(4)&&ApplePaySession?.canMakePayments()}catch{console.error("ApplePaySession is not supported on this device.")}})()&&(e("#awx-express-checkout-wrapper").show(),e(".awx-apple-pay-btn").show(),e("#awx-express-checkout-button-separator").show())})),g.on("click",(t=>{e(".awx-express-checkout-error").html("").hide()})),g.on("validateMerchant",(async e=>{awxExpressCheckoutSettings.isProductPage&&await r();const t=await(e=>{const t={security:awxExpressCheckoutSettings.nonce.startPaymentSession,validationURL:e,origin:window.location.host};return n().ajax({type:"POST",data:t,url:a("start_payment_session")}).done((e=>e)).fail((e=>({success:!1,message:e})))})(e?.detail?.validationURL),{paymentSession:s,error:i}=t;s?g.completeValidation(s):g.fail(i)})),g.on("shippingAddressChange",(async e=>{const n=await c();if(n.success)if(n.requiresShipping){const n=await s(e?.detail?.shippingAddress);if(n&&n.success){const{shipping:e,cart:s}=n;p=e.shippingMethods,g.update({amount:{value:s?.orderInfo?.total?.amount||0},lineItems:y(s.orderInfo.displayItems),shippingMethods:(a=e.shippingOptions,a.map((e=>({identifier:e.id,label:e.label,detail:e.description,amount:e.amount})))),totalPriceLabel:t.totalPriceLabel})}else p=[],console.warn(n?.message),g.fail({message:n?.message})}else g.update({amount:{value:n?.orderInfo?.total?.amount||0},lineItems:y(n.orderInfo.displayItems),totalPriceLabel:t.totalPriceLabel});else console.warn(n.message),g.fail({message:n.message});var a})),g.on("shippingMethodChange",(async e=>{const n=await i(e.detail.shippingMethod.identifier,p);if(n&&n.success){const{cart:e}=n;g.update({amount:{value:e?.orderInfo?.total?.amount||0},lineItems:y(e.orderInfo.displayItems),totalPriceLabel:t.totalPriceLabel})}else console.warn(n.message),g.fail({message:n?.message})})),g.on("authorized",(async e=>{let t=e?.detail?.paymentData||{};t.shippingMethods=p;const n=await l(t,"applepay");d.processPayment(g,n)})),g.on("error",(e=>{console.error("There was an error",e)}))},getApplePayRequestOptions:e=>{const{button:t,checkout:n}=awxExpressCheckoutSettings,{countryCode:a,currencyCode:s,orderInfo:i,requiresShipping:o}=e;return{mode:t.mode,buttonColor:t.theme,buttonType:t.buttonType,origin:window.location.origin,totalPriceLabel:n.totalPriceLabel,countryCode:a||n.countryCode,requiredBillingContactFields:h,requiredShippingContactFields:m(o),amount:{value:i?i.total.amount:n.subTotal,currency:s||n.currencyCode},lineItems:y(i.displayItems),autoCapture:n.autoCapture}},processPayment:(t,n)=>{if(function(e=5e3){jQuery.blockUI({message:null,overlayCSS:{background:"#fff",opacity:.6}}),setTimeout((function(){jQuery.unblockUI()}),e)}(5e4),"success"===n.result){const{createConsent:a,clientSecret:s,confirmationUrl:i}=n.payload;a?t.createPaymentConsent({client_secret:s}).then((()=>{location.href=i})).catch((t=>{g(),e(".awx-express-checkout-error").html(t.message).show(),console.warn(t.message)})):t.confirmIntent({client_secret:s}).then((()=>{location.href=i})).catch((t=>{g(),e(".awx-express-checkout-error").html(t.message).show(),console.warn(t.message)}))}else g(),e(".awx-express-checkout-error").html(n?.messages).show(),console.warn(n),t.confirmIntent({client_secret:""}).then((()=>{})).catch((e=>{console.warn(e)}))},setButtonHeight:function(){const{button:t}=awxExpressCheckoutSettings,n=t.height;e(".awx-apple-pay-btn apple-pay-button").css("--apple-pay-button-height",n),e(".awx-google-pay-btn button").css("height",n)}};e(document.body).on("updated_checkout",(function(){e(".payment_method_airwallex_express_checkout").hide()})),"awxExpressCheckoutSettings"in window&&"env"in awxExpressCheckoutSettings&&(Airwallex.init({env:awxExpressCheckoutSettings.env,origin:window.location.origin,locale:awxExpressCheckoutSettings.locale}),d.init(),e(document.body).on("updated_cart_totals",(function(){d.init()})),e(document.body).on("updated_checkout",(function(){d.init()})),e(document.body).on("change",'[name="quantity"]',(function(){d.init()})))}))}();